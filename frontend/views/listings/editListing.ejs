<% layout('layouts/boilerplate') %>
<body>
  <div class="container">
    <!-- Hero Section -->
    <div class="edit-listing-hero text-center mb-5">
      <h1 class="edit-listing-title">Edit Your Property Listing</h1>
      <p class="edit-listing-subtitle">
        Update your property details to attract more tenants
      </p>
    </div>

    <!-- Form Section -->
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10">
        <div class="edit-listing-form-card">
          <form
            action="/listing/<%= editListing._id %>?_method=PUT"
            method="POST"
            class="listing-form needs-validation"
            enctype="multipart/form-data"
            novalidate>
            <!-- Basic Information Section -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-edit me-2"></i>Basic Information
              </h3>

              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="title" class="form-label">
                      <i class="fas fa-home me-2"></i>Property Title
                    </label>
                    <input
                      type="text"
                      id="title"
                      name="title"
                      class="form-control"
                      value="<%= editListing.title %>"
                      placeholder="e.g., Beautiful 2BR Apartment in City Center"
                      required />
                    <div class="invalid-feedback">Please Enter title</div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-group">
                    <label for="price" class="form-label">
                      <i class="fas fa-tag me-2"></i>Monthly Rent (â‚¹)
                    </label>
                    <input
                      type="number"
                      id="price"
                      name="price"
                      class="form-control"
                      value="<%= editListing.price %>"
                      placeholder="15000"
                      required />
                    <div class="invalid-feedback">Price should be valid</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Location Section -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-map-marker-alt me-2"></i>Location Details
              </h3>

              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="location" class="form-label">
                      <i class="fas fa-building me-2"></i>City/Area
                    </label>
                    <input
                      type="text"
                      id="location"
                      name="location"
                      class="form-control"
                      value="<%= editListing.location %>"
                      placeholder="e.g., Bandra West, Mumbai"
                      required />
                    <div class="invalid-feedback">Please enter location</div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-group">
                    <label for="country" class="form-label">
                      <i class="fas fa-globe me-2"></i>Country
                    </label>
                    <input
                      type="text"
                      id="country"
                      name="country"
                      class="form-control"
                      value="<%= editListing.country %>"
                      placeholder="India"
                      required />
                    <div class="invalid-feedback">Please enter country</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Description Section -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-align-left me-2"></i>Property Description
              </h3>

              <div class="form-group">
                <label for="description" class="form-label">
                  <i class="fas fa-file-text me-2"></i>Detailed Description
                </label>
                <textarea
                  id="description"
                  name="desc"
                  class="form-control"
                  rows="6"
                  placeholder="Describe your property in detail. Include features, amenities, nearby attractions, and what makes this property special..."
                  required>
<%= editListing.desc %></textarea
                >
                <div class="invalid-feedback">
                  Enter the detailed description about property
                </div>
                <div class="form-help">
                  <i class="fas fa-lightbulb me-1"></i>
                  Tip: Be detailed and honest about your property to attract the
                  right tenants
                </div>
              </div>
            </div>

            <!-- Image Section -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-image me-2"></i>Property Images
              </h3>

              <div class="form-group">
                <label for="image" class="form-label">
                  <i class="fas fa-link me-2"></i>Upload Image
                </label>
                <input
                  type="file"
                  id="image"
                  name="image"
                  class="form-control"
                  accept="image/*" />
                <div class="invalid-feedback">Please provide image</div>
              </div>

              <!-- Current Image Display -->
              <div class="current-image-container">
                <h5 class="current-image-title">Current Image</h5>
                <div class="current-image">
                  <img src="<%= newImageurl %>" alt="Current Property Image" />
                </div>
              </div>

              <!-- Image Preview -->
              <div
                class="image-preview-container"
                id="imagePreview"
                style="display: none">
                <h5 class="preview-title">Updated Image Preview</h5>
                <div class="image-preview">
                  <img
                    id="previewImage"
                    src="<%= newImageurl || editListing.image.url %>"
                    alt="Updated Property Preview" />
                </div>
              </div>
            </div>

            <!-- Property Features Section -->
            <div class="form-section">
              <h3 class="section-title">
                <i class="fas fa-star me-2"></i>Property Features
              </h3>

              <div class="features-grid">
                <div class="feature-checkbox">
                  <input type="checkbox" id="wifi" name="features[]"
                  value="wifi" <%= (Array.isArray(editListing.amenities) &&
                  editListing.amenities.includes('wifi')) ? 'checked' : '' %> />
                  <label for="wifi">
                    <i class="fas fa-wifi"></i>High-Speed WiFi
                  </label>
                </div>

                <div class="feature-checkbox">
                  <input type="checkbox" id="parking" name="features[]"
                  value="parking" <%= (Array.isArray(editListing.amenities) &&
                  editListing.amenities.includes('parking')) ? 'checked' : '' %>
                  />
                  <label for="parking">
                    <i class="fas fa-car"></i>Parking Available
                  </label>
                </div>

                <div class="feature-checkbox">
                  <input type="checkbox" id="ac" name="features[]" value="ac"
                  <%= (Array.isArray(editListing.amenities) &&
                  editListing.amenities.includes('ac')) ? 'checked' : '' %> />
                  <label for="ac">
                    <i class="fas fa-snowflake"></i>Air Conditioning
                  </label>
                </div>

                <div class="feature-checkbox">
                  <input type="checkbox" id="kitchen" name="features[]"
                  value="kitchen" <%= (Array.isArray(editListing.amenities) &&
                  editListing.amenities.includes('kitchen')) ? 'checked' : '' %>
                  />
                  <label for="kitchen">
                    <i class="fas fa-utensils"></i>Fully Equipped Kitchen
                  </label>
                </div>

                <div class="feature-checkbox">
                  <input type="checkbox" id="laundry" name="features[]"
                  value="laundry" <%= (Array.isArray(editListing.amenities) &&
                  editListing.amenities.includes('laundry')) ? 'checked' : '' %>
                  />
                  <label for="laundry">
                    <i class="fas fa-tshirt"></i>In-Unit Laundry
                  </label>
                </div>

                <div class="feature-checkbox">
                  <input type="checkbox" id="gym" name="features[]" value="gym"
                  <%= (Array.isArray(editListing.amenities) &&
                  editListing.amenities.includes('gym')) ? 'checked' : '' %> />
                  <label for="gym">
                    <i class="fas fa-dumbbell"></i>Fitness Center
                  </label>
                </div>
              </div>
            </div>

            <!-- Submit Section -->
            <div class="form-section submit-section">
              <div class="row">
                <div class="col-md-4">
                  <button
                    type="button"
                    class="btn btn-outline-dark btn-lg w-100"
                    onclick="history.back()">
                    <i class="fas fa-arrow-left me-2"></i>Go Back
                  </button>
                </div>
                <div class="col-md-4">
                  <a
                    href="/listing/<%= editListing._id %>?_method=DELETE"
                    class="btn btn-outline-secondary btn-lg w-100">
                    <i class="fas fa-eye me-2"></i>Delete Listing
                  </a>
                </div>
                <div class="col-md-4">
                  <button type="submit" class="btn btn-dark btn-lg w-100">
                    <i class="fas fa-save me-2"></i>Update Listing
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Image preview functionality
    document.getElementById("image").addEventListener("input", function () {
      const imageUrl = this.value;
      const previewContainer = document.getElementById("imagePreview");
      const previewImage = document.getElementById("previewImage");

      if (imageUrl && isValidUrl(imageUrl)) {
        previewImage.src = imageUrl;
        previewContainer.style.display = "block";
      } else {
        previewContainer.style.display = "none";
      }
    });

    function isValidUrl(string) {
      try {
        new URL(string);
        return true;
      } catch (_) {
        return false;
      }
    }
  </script>
</body>
